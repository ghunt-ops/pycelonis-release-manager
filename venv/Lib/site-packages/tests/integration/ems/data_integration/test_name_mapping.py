import pandas as pd
import pytest

from ....assets import NAME_MAPPING_ASSET


@pytest.mark.vcr()
class TestNameMapping:
    def test_name_mapping(self, pycelonis_data_pool, pycelonis_data_model):
        pycelonis_data_pool.create_table(pd.DataFrame({"_CASE_KEY": ["TEST"]}), "ACTIVITIES")
        pycelonis_data_model.add_table("ACTIVITIES")
        pycelonis_data_model.reload()

        name_mappings = pycelonis_data_model.add_name_mappings(NAME_MAPPING_ASSET)

        assert len(name_mappings) == 1

        name_mapping = name_mappings[0]
        assert name_mapping.identifier == "ACTIVITIES"
        assert name_mapping.translation == "Activities"
        assert name_mapping.mapping_type == "table-mapping"

        pycelonis_data_model.delete_name_mappings()

        name_mappings = pycelonis_data_model.get_name_mappings()
        assert len(name_mappings) == 0
