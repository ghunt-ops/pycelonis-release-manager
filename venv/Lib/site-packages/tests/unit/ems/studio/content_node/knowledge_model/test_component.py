from pycelonis.ems.studio.content_node.knowledge_model.component import (
    FinalAttribute,
    FinalFilter,
    FinalIdentifier,
    FinalRecord,
)
from pycelonis_core.base.collection import CelonisCollection


class TestFilter:
    def test_filter_query(self):
        filter_raw = {
            "id": "test_filter",
            "display_name": "TEST_FILTER",
            "pql": 'FILTER "ACTIVITY_TABLE"."ACTIVITY_EN" IS NOT NULL',
        }

        test_filter = FinalFilter(**filter_raw)
        test_filter_query = test_filter.get_filter()

        assert test_filter_query.query == 'FILTER "ACTIVITY_TABLE"."ACTIVITY_EN" IS NOT NULL'


class TestAttribute:
    def test_attribute_query(self):
        attribute_raw = {
            "id": "ACTIVITY_EN",
            "display_name": "Activity En",
            "pql": '"ACTIVITY_TABLE"."ACTIVITY_EN"',
        }

        test_attribute = FinalAttribute(**attribute_raw)
        test_attribute_query = test_attribute.get_column()

        assert test_attribute_query.name == "ACTIVITY_EN"
        assert test_attribute_query.query == '"ACTIVITY_TABLE"."ACTIVITY_EN"'


class TestIdentifier:
    def test_identifier_query(self):
        identifier_raw = {
            "id": "test_identifier",
            "display_name": "TEST_IDENTIFIER",
            "pql": '"ACTIVITY_TABLE"."ACTIVITY_EN"',
        }

        test_identifier = FinalIdentifier(**identifier_raw)
        test_identifier_query = test_identifier.get_column()

        assert test_identifier_query.name == "test_identifier"
        assert test_identifier_query.query == '"ACTIVITY_TABLE"."ACTIVITY_EN"'


class TestRecord:
    def test_record_attributes(self):
        record_raw = {
            "id": "ACTIVITY_TABLE",
            "display_name": "Activity Table",
            "identifier": {
                "id": "test_identifier",
                "display_name": "TEST_IDENTIFIER",
                "pql": '"ACTIVITY_TABLE"."ACTIVITY_EN"',
            },
            "pql": '"ACTIVITY_TABLE"',
            "attributes": [
                {
                    "id": "ACTIVITY_EN",
                    "display_name": "Activity En",
                    "pql": '"ACTIVITY_TABLE"."ACTIVITY_EN"',
                },
            ],
        }

        test_record = FinalRecord(**record_raw)

        assert isinstance(test_record.attributes, CelonisCollection)
        assert isinstance(test_record.identifier, FinalIdentifier)
