import pytest
from pycelonis.ems.studio.content_node import AssetType, ContentNode
from pycelonis.ems.studio.content_node.action_flow import ActionFlow
from pycelonis.ems.studio.content_node.analysis import Analysis
from pycelonis.ems.studio.content_node.content_node_factory import ContentNodeFactory
from pycelonis.ems.studio.content_node.folder import Folder
from pycelonis.ems.studio.content_node.knowledge_model import KnowledgeModel
from pycelonis.ems.studio.content_node.package import Package
from pycelonis.ems.studio.content_node.simulation import Simulation
from pycelonis.ems.studio.content_node.skill import Skill
from pycelonis.ems.studio.content_node.view import View
from pycelonis.service.package_manager.service import ContentNodeType


class TestContentNodeFactory:
    @pytest.mark.parametrize(
        "node_type,asset_type,node_class",
        [
            (ContentNodeType.ASSET, AssetType.SEMANTIC_MODEL.value, KnowledgeModel),
            (ContentNodeType.ASSET, AssetType.ANALYSIS.value, Analysis),
            (ContentNodeType.ASSET, AssetType.SCENARIO.value, ActionFlow),
            (ContentNodeType.ASSET, AssetType.BOARD.value, View),
            (ContentNodeType.ASSET, AssetType.SIMULATION_ASSET.value, Simulation),
            (ContentNodeType.ASSET, AssetType.SKILL.value, Skill),
            (ContentNodeType.ASSET, "NEW_ASSET", ContentNode),  # Unknown assets are instantiated as ContentNode
            (ContentNodeType.FOLDER, None, Folder),
            (ContentNodeType.PACKAGE, None, Package),
        ],
    )
    def test_content_node_factory_creates_right_instance(
        self, mock_client, example_content_node_transport, node_type, asset_type, node_class
    ):
        example_content_node_transport.node_type = node_type
        example_content_node_transport.asset_type = asset_type

        content_node = ContentNodeFactory.get_content_node(mock_client, example_content_node_transport)

        assert isinstance(content_node, node_class)
        assert content_node.client == mock_client
        assert content_node.dict() == example_content_node_transport.dict()
