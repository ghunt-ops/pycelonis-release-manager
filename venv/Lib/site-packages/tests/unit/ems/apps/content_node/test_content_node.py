from unittest.mock import Mock

from pycelonis.ems.apps.content_node import PublishedContentNode
from pycelonis.service.package_manager.service import PackageManagerService


class TestPublishedContentNode:
    def test_published_content_node_from_transport_has_same_values_as_transport(
        self, mock_client, example_content_node_transport
    ):
        content_node = PublishedContentNode.from_transport(mock_client, example_content_node_transport)

        assert isinstance(content_node, PublishedContentNode)
        assert content_node.client == mock_client
        assert content_node.dict() == example_content_node_transport.dict()

    def test_synced_published_content_node_has_synced_values(
        self, example_published_content_node, example_content_node_transport
    ):
        UPDATED_NAME = "NEW_NAME"

        example_content_node_transport.name = UPDATED_NAME  # Simulate change in EMS
        PackageManagerService.get_api_final_nodes_id = Mock(return_value=example_content_node_transport)

        example_published_content_node.sync()

        PackageManagerService.get_api_final_nodes_id.assert_called_once_with(
            example_published_content_node.client,
            example_published_content_node.id,
        )
        assert example_published_content_node.dict() == example_content_node_transport.dict()
