from unittest.mock import Mock

import pytest
from pycelonis.ems.team import Team, UserServicePermissionsTransport
from pycelonis.service.team.service import TeamService, TeamTransport


@pytest.fixture()
def team(mock_client):
    return Team(mock_client)


class TestTeam:
    def test_get_permissions_returns_permissions(self, team):
        example_permissions = [UserServicePermissionsTransport(service_name="test_service", permissions=["READ"])]
        TeamService.get_api_cloud_permissions = Mock(return_value=example_permissions)

        permissions = team.get_permissions()

        TeamService.get_api_cloud_permissions.assert_called_with(
            team.client,
        )
        assert len(permissions) == 1
        assert permissions[0] == example_permissions[0]

    def test_get_team_returns_team(self, team):
        example_team = TeamTransport(name="TEST_NAME")
        TeamService.get_api_team = Mock(return_value=example_team)

        team_transport = team.get_team()

        TeamService.get_api_team.assert_called_with(
            team.client,
        )
        assert team_transport.name == "TEST_NAME"
